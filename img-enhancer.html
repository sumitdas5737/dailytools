<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Image Enhancer ‚Äì Notebook Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #f3f4f6;
      --surface: #ffffff;
      --surface-soft: #f9fafb;
      --border: #e5e7eb;
      --border-soft: #d1d5db;
      --text-main: #111827;
      --text-soft: #6b7280;
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: var(--bg);
      color: var(--text-main);
      display: flex;
      padding: 24px;
      justify-content: center;
    }

    .app-shell {
      max-width: 1200px;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .title-block h1 {
      margin: 0;
      font-size: 22px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .title-pill {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 500;
    }

    .title-block p {
      margin: 6px 0 0;
      font-size: 13px;
      color: var(--text-soft);
    }

    .meta-badge {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background-color: var(--surface);
      color: var(--text-soft);
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .meta-badge span {
      display: block;
    }

    a.back-link {
      color: var(--accent);
      text-decoration: none;
      font-size: 13px;
    }

    a.back-link:hover {
      text-decoration: underline;
    }

    .main {
      display: grid;
      grid-template-columns: minmax(260px, 320px) minmax(0, 1fr);
      gap: 20px;
      align-items: start;
    }

    .card {
      background-color: var(--surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border);
      padding: 18px 18px 20px;
    }

    .section-title {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
      margin-bottom: 12px;
    }

    .field-group {
      margin-bottom: 12px;
    }

    .field-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .field-label span.hint {
      font-size: 11px;
      color: var(--text-soft);
    }

    input[type="file"] {
      width: 100%;
      font-size: 13px;
      border-radius: var(--radius-md);
      padding: 6px 9px;
      border: 1px solid var(--border-soft);
      background-color: var(--surface-soft);
      color: var(--text-main);
      outline: none;
    }

    input[type="file"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.2);
    }

    .status {
      font-size: 11px;
      margin-top: 4px;
      color: var(--text-soft);
    }

    .status.ok {
      color: #15803d;
    }

    .status.error {
      color: #b91c1c;
    }

    .slider-group {
      margin-top: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 10px;
      border-radius: 10px;
      background: var(--surface-soft);
      border: 1px solid var(--border);
    }

    .slider-row {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .slider-row label {
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      color: var(--text-soft);
    }

    .slider-row label span.value {
      font-variant-numeric: tabular-nums;
    }

    input[type="range"] {
      width: 100%;
    }

    button {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 9px 12px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.12s ease, border-color 0.12s ease, transform 0.05s ease,
        box-shadow 0.12s ease;
    }

    .btn-primary {
      background-color: var(--accent);
      color: #ffffff;
      border-color: var(--accent);
      width: 100%;
      margin-top: 10px;
    }

    .btn-primary:hover {
      background-color: #1d4ed8;
      border-color: #1d4ed8;
      box-shadow: 0 8px 16px rgba(37, 99, 235, 0.3);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background-color: #ffffff;
      color: var(--text-main);
      border-color: var(--border-soft);
      width: 100%;
      margin-top: 6px;
    }

    .btn-secondary:hover {
      background-color: var(--surface-soft);
      border-color: var(--border);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    /* Right: preview */

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .preview-header h2 {
      margin: 0;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .preview-area {
      border-radius: 14px;
      border: 1px solid var(--border);
      background-color: var(--surface-soft);
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: auto;
      padding: 10px;
    }

    #previewCanvas {
      max-width: 100%;
      max-height: 480px;
      border-radius: 10px;
      background-color: #e5e7eb;
    }

    .empty-state {
      font-size: 13px;
      color: var(--text-soft);
      padding: 20px;
      text-align: center;
    }

    /* üîç Zoom overlay */

    .zoom-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .zoom-panel {
      background: var(--surface);
      border-radius: 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-soft);
      width: min(1000px, 96vw);
      height: min(650px, 90vh);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .zoom-header {
      padding: 10px 14px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .zoom-header-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .zoom-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-main);
    }

    .zoom-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .zoom-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: var(--text-soft);
    }

    .zoom-controls input[type="range"] {
      width: 150px;
    }

    .zoom-close-btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 4px 10px;
      background: var(--surface-soft);
      font-size: 12px;
      cursor: pointer;
    }

    .zoom-close-btn:hover {
      background: #e5e7eb;
    }

    .zoom-body {
      flex: 1;
      display: flex;
      padding: 10px;
      background: var(--surface-soft);
    }

    .zoom-scroll {
      flex: 1;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #111827;
      overflow: auto;
      padding: 10px;
    }

    #zoomCanvas {
      display: block;
      background: #111827;
      margin: 0;
      transform-origin: top left;
    }

    @media (max-width: 900px) {
      .main {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 16px;
      }
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>

<div class="app-shell">
  <!-- Header -->
  <header class="header">
    <div class="title-block">
      <!-- BACK BUTTON -->
<button class="back-btn" onclick="goHome()">‚Üê Back to home</button>

<style>
  .back-btn {
    border: 1px solid #e5e7eb;
    background: #f9fafb;
    color: #111827;
    font-family: system-ui, sans-serif;
    font-size: 14px;
    padding: 7px 14px;
    border-radius: 999px;
    cursor: pointer;
    margin-bottom: 12px;
    transition: 0.15s ease;
  }

  .back-btn:hover {
    background: #e8f0ff;
    border-color: #2563eb;
    color: #2563eb;
    transform: translateY(-1px);
  }
</style>

<script>
  function goHome() {
    window.location.href = "index.html"; 
  }
</script>

      <h1>
        Image Enhancer
        <span class="title-pill">High quality</span>
      </h1>
      <p>Upload your notebook images, tweak brightness/contrast/saturation/sharpness, and download in full quality.</p>
    </div>
    <div class="meta-badge">
      <span>Original resolution ¬∑ PNG export</span>
      <span style="font-size:12px;">
        <a href="index.html" class="back-link">‚Üê Back to Notebook Writer</a>
      </span>
    </div>
  </header>

  <!-- Main -->
  <main class="main">
    <!-- Left: controls -->
    <section class="card">
      <div class="section-title">Image</div>

      <div class="field-group">
        <div class="field-label">
          <span>Select image</span>
          <span class="hint">PNG / JPG</span>
        </div>
        <input type="file" id="imageInput" accept="image/*" />
        <div id="imageStatus" class="status">No image selected.</div>
      </div>

      <div class="section-title" style="margin-top: 10px;">Adjustments</div>

      <div class="slider-group">
        <div class="slider-row">
          <label>
            <span>Brightness</span>
            <span class="value" id="brightnessValue">100%</span>
          </label>
          <input type="range" id="brightnessSlider" min="50" max="150" value="100" />
        </div>

        <div class="slider-row">
          <label>
            <span>Contrast</span>
            <span class="value" id="contrastValue">100%</span>
          </label>
          <input type="range" id="contrastSlider" min="50" max="150" value="100" />
        </div>

        <div class="slider-row">
          <label>
            <span>Saturation</span>
            <span class="value" id="saturationValue">100%</span>
          </label>
          <input type="range" id="saturationSlider" min="0" max="200" value="100" />
        </div>

        <div class="slider-row">
          <label>
            <span>Sharpness</span>
            <span class="value" id="sharpnessValue">0</span>
          </label>
          <input type="range" id="sharpnessSlider" min="0" max="100" value="0" />
        </div>
      </div>

      <button id="resetBtn" class="btn-secondary">
        üîÑ Reset adjustments
      </button>
      <button id="previewBtn" class="btn-secondary">
        üîç Open zoom preview
      </button>
      <button id="downloadBtn" class="btn-primary">
        ‚¨áÔ∏è Download enhanced image (PNG, full size)
      </button>

      <div id="actionStatus" class="status" style="margin-top:8px;"></div>
    </section>

    <!-- Right: preview -->
    <section class="card">
      <div class="preview-header">
        <h2>Preview</h2>
        <span id="infoLabel" style="font-size:12px;color:var(--text-soft);">No image</span>
      </div>
      <div class="preview-area">
        <canvas id="previewCanvas"></canvas>
        <div id="emptyState" class="empty-state">
          Upload an image on the left. Adjust sliders to enhance it, then download as PNG in original resolution.
        </div>
      </div>
    </section>
  </main>
</div>

<!-- üîç Zoom overlay -->
<div id="zoomOverlay" class="zoom-overlay">
  <div class="zoom-panel">
    <div class="zoom-header">
      <div class="zoom-header-left">
        <div class="zoom-title">Zoom preview</div>
        <div class="zoom-sub" id="zoomInfo">100% ¬∑ Scroll to pan</div>
      </div>
      <div class="zoom-controls">
        <span>Zoom</span>
        <input type="range" id="zoomSlider" min="25" max="300" value="100" />
        <span id="zoomValue">100%</span>
        <button id="zoomCloseBtn" class="zoom-close-btn">Close</button>
      </div>
    </div>
    <div class="zoom-body">
      <div class="zoom-scroll">
        <canvas id="zoomCanvas"></canvas>
      </div>
    </div>
  </div>
</div>

<script>
  const imageInput      = document.getElementById("imageInput");
  const imageStatus     = document.getElementById("imageStatus");
  const actionStatus    = document.getElementById("actionStatus");
  const infoLabel       = document.getElementById("infoLabel");

  const brightnessSlider = document.getElementById("brightnessSlider");
  const contrastSlider   = document.getElementById("contrastSlider");
  const saturationSlider = document.getElementById("saturationSlider");
  const sharpnessSlider  = document.getElementById("sharpnessSlider");

  const brightnessValue = document.getElementById("brightnessValue");
  const contrastValue   = document.getElementById("contrastValue");
  const saturationValue = document.getElementById("saturationValue");
  const sharpnessValue  = document.getElementById("sharpnessValue");

  const resetBtn    = document.getElementById("resetBtn");
  const downloadBtn = document.getElementById("downloadBtn");
  const previewBtn  = document.getElementById("previewBtn");

  const canvas = document.getElementById("previewCanvas");
  const ctx    = canvas.getContext("2d");
  const emptyState = document.getElementById("emptyState");

  // Zoom elements
  const zoomOverlay = document.getElementById("zoomOverlay");
  const zoomCanvas  = document.getElementById("zoomCanvas");
  const zoomCtx     = zoomCanvas.getContext("2d");
  const zoomSlider  = document.getElementById("zoomSlider");
  const zoomValue   = document.getElementById("zoomValue");
  const zoomCloseBtn= document.getElementById("zoomCloseBtn");
  const zoomInfo    = document.getElementById("zoomInfo");

  let originalImage = new Image();
  let hasImage = false;

  imageInput.addEventListener("change", function () {
    const file = this.files[0];
    if (!file) {
      imageStatus.textContent = "No image selected.";
      imageStatus.className = "status";
      hasImage = false;
      emptyState.style.display = "block";
      return;
    }

    if (!file.type.startsWith("image/")) {
      imageStatus.textContent = "Please select a valid image file.";
      imageStatus.className = "status error";
      this.value = "";
      hasImage = false;
      emptyState.style.display = "block";
      return;
    }

    const url = URL.createObjectURL(file);
    originalImage = new Image();
    originalImage.onload = function () {
      hasImage = true;
      imageStatus.textContent = "Loaded: " + file.name +
        ` (${originalImage.naturalWidth}√ó${originalImage.naturalHeight}px)`;
      imageStatus.className = "status ok";
      infoLabel.textContent = `${originalImage.naturalWidth}√ó${originalImage.naturalHeight} px ¬∑ Full quality`;

      // Full resolution canvas
      canvas.width  = originalImage.naturalWidth;
      canvas.height = originalImage.naturalHeight;

      emptyState.style.display = "none";
      applyEnhancements();
      URL.revokeObjectURL(url);
    };
    originalImage.onerror = function () {
      imageStatus.textContent = "Could not load image.";
      imageStatus.className = "status error";
      hasImage = false;
      emptyState.style.display = "block";
    };
    originalImage.src = url;
  });

  function renderEnhanced(targetCtx, targetCanvas) {
    const b = brightnessSlider.value;
    const c = contrastSlider.value;
    const s = saturationSlider.value;
    const sharpenAmount = sharpnessSlider.value;

    // Update labels
    brightnessValue.textContent = b + "%";
    contrastValue.textContent   = c + "%";
    saturationValue.textContent = s + "%";
    sharpnessValue.textContent  = sharpenAmount;

    targetCtx.save();
    targetCtx.filter = `brightness(${b}%) contrast(${c}%) saturate(${s}%)`;
    targetCtx.clearRect(0, 0, targetCanvas.width, targetCanvas.height);
    targetCtx.drawImage(originalImage, 0, 0, targetCanvas.width, targetCanvas.height);
    targetCtx.restore();

    if (sharpenAmount > 0) {
      const amt = sharpenAmount / 100;
      const imageData = targetCtx.getImageData(0, 0, targetCanvas.width, targetCanvas.height);
      const sharpened = applySharpen(imageData, amt);
      targetCtx.putImageData(sharpened, 0, 0);
    }
  }

  function applyEnhancements() {
    if (!hasImage) return;
    renderEnhanced(ctx, canvas);
  }

  function applySharpen(imageData, amount) {
    const w = imageData.width;
    const h = imageData.height;
    const src = imageData.data;
    const out = new Uint8ClampedArray(src.length);

    const kCenter = 1 + 4 * amount;
    const kernel = [
      0, -amount, 0,
      -amount, kCenter, -amount,
      0, -amount, 0
    ];

    const side = 3;
    const halfSide = 1;

    for (let y = 0; y < h; y++) {
      for (let x = 0; x < w; x++) {
        let r = 0, g = 0, b = 0, a = 0;

        for (let ky = 0; ky < side; ky++) {
          for (let kx = 0; kx < side; kx++) {
            const px = x + kx - halfSide;
            const py = y + ky - halfSide;

            if (px >= 0 && px < w && py >= 0 && py < h) {
              const offset = (py * w + px) * 4;
              const weight = kernel[ky * side + kx];

              r += src[offset] * weight;
              g += src[offset + 1] * weight;
              b += src[offset + 2] * weight;
              a += src[offset + 3] * weight;
            }
          }
        }

        const dstOff = (y * w + x) * 4;
        out[dstOff]     = clamp(r, 0, 255);
        out[dstOff + 1] = clamp(g, 0, 255);
        out[dstOff + 2] = clamp(b, 0, 255);
        out[dstOff + 3] = clamp(a, 0, 255);
      }
    }

    return new ImageData(out, w, h);
  }

  function clamp(val, min, max) {
    return val < min ? min : val > max ? max : val;
  }

  [brightnessSlider, contrastSlider, saturationSlider, sharpnessSlider].forEach(slider => {
    slider.addEventListener("input", () => {
      applyEnhancements();
      actionStatus.textContent = "";
    });
  });

  resetBtn.addEventListener("click", () => {
    brightnessSlider.value = 100;
    contrastSlider.value   = 100;
    saturationSlider.value = 100;
    sharpnessSlider.value  = 0;
    applyEnhancements();
    actionStatus.textContent = "Adjustments reset.";
    actionStatus.className = "status";
  });

  downloadBtn.addEventListener("click", () => {
    if (!hasImage) {
      actionStatus.textContent = "Upload an image first.";
      actionStatus.className = "status error";
      return;
    }

    const dataUrl = canvas.toDataURL("image/png");
    const link = document.createElement("a");
    link.href = dataUrl;
    link.download = "enhanced-image.png";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    actionStatus.textContent = "Image downloaded as enhanced-image.png (full quality).";
    actionStatus.className = "status ok";
  });

  /* üîç Zoom preview logic */

  previewBtn.addEventListener("click", () => {
    if (!hasImage) {
      actionStatus.textContent = "Upload an image first.";
      actionStatus.className = "status error";
      return;
    }

    // Match original resolution
    zoomCanvas.width  = originalImage.naturalWidth;
    zoomCanvas.height = originalImage.naturalHeight;

    renderEnhanced(zoomCtx, zoomCanvas);

    zoomSlider.value = 100;
    zoomValue.textContent = "100%";
    zoomCanvas.style.transform = "scale(1)";
    zoomInfo.textContent = `${zoomCanvas.width}√ó${zoomCanvas.height} px ¬∑ Scroll to pan`;

    zoomOverlay.style.display = "flex";
  });

  zoomSlider.addEventListener("input", () => {
    const zoom = Number(zoomSlider.value);
    zoomValue.textContent = zoom + "%";
    const scale = zoom / 100;
    zoomCanvas.style.transform = `scale(${scale})`;
  });

  zoomCloseBtn.addEventListener("click", () => {
    zoomOverlay.style.display = "none";
  });

  // Close overlay with ESC key
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && zoomOverlay.style.display === "flex") {
      zoomOverlay.style.display = "none";
    }
  });
</script>

</body>
</html>
